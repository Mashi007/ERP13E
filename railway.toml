[build]
builder = "nixpacks"

[deploy]
# Optimized start command compatible with ERP13E
startCommand = "gunicorn --bind 0.0.0.0:$PORT --workers 3 --threads 2 --worker-class gthread --worker-connections 1000 --max-requests 1000 --max-requests-jitter 100 --preload --access-logfile - --error-logfile - --log-level info --timeout 180 wsgi:application"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3
healthcheckPath = "/health"
healthcheckTimeout = 30

# ERP13E Production Environment Variables
# Compatible with existing configuration
[environments.production]
variables = { 
  FLASK_ENV = "production",
  RAILWAY_ENVIRONMENT = "production", 
  PYTHONPATH = "/app",
  WEB_CONCURRENCY = "3",
  WORKER_TIMEOUT = "180",
  WORKER_CLASS = "gthread",
  MAX_REQUESTS = "1000",
  PRELOAD_APP = "true"
}

# ERP13E Staging Environment (new)
[environments.staging] 
variables = { 
  FLASK_ENV = "staging",
  RAILWAY_ENVIRONMENT = "staging",
  PYTHONPATH = "/app",
  WEB_CONCURRENCY = "2",
  WORKER_TIMEOUT = "120",
  WORKER_CLASS = "gthread",
  MAX_REQUESTS = "500"
}

# ERP13E Development Environment (new)
[environments.development]
variables = { 
  FLASK_ENV = "development",
  RAILWAY_ENVIRONMENT = "development",
  PYTHONPATH = "/app",
  WEB_CONCURRENCY = "1",
  WORKER_TIMEOUT = "60",
  WORKER_CLASS = "sync",
  DEBUG = "false"
}

# ERP13E Railway Configuration
# Optimized for enterprise workloads with existing DB
# Maintains compatibility with Mashi007/ERP13E repository
# Respects existing JWT_SECRET_KEY and SECRET_KEY configuration
