# ============================================================================
# üìÅ Ruta: /railway.toml
# üìÑ Nombre: railway.toml
# üèóÔ∏è Prop√≥sito: Configuraci√≥n Railway optimizada ERP13 Enterprise v3.1
# ‚ö° Performance: Health checks, restart policies, resource management
# üîí Seguridad: Variables de entorno seguras, timeouts optimizados
# ============================================================================

[build]
builder = "NIXPACKS"
buildCommand = "pip install --no-cache-dir -r requirements.txt"

[deploy]
# Health check configuration optimizada
healthcheckPath = "/health"
healthcheckTimeout = 60
healthcheckInterval = 15
healthcheckRetries = 5

# Restart policy enterprise
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 5

# Resource management
numReplicas = 1
memoryLimit = 1024
cpuLimit = 1000

# Startup configuration
startCommand = "gunicorn --bind 0.0.0.0:$PORT --workers $WEB_CONCURRENCY --threads 4 --timeout 120 --max-requests 1000 --preload wsgi:application"

[environments.production]
variables = { 
    FLASK_ENV = "production",
    PYTHONPATH = "/app",
    WEB_CONCURRENCY = "2",
    GUNICORN_WORKERS = "2",
    GUNICORN_THREADS = "4",
    GUNICORN_TIMEOUT = "120",
    GUNICORN_KEEPALIVE = "5",
    GUNICORN_MAX_REQUESTS = "1000",
    SECRET_KEY = "${{ secrets.SECRET_KEY }}",
    LOG_LEVEL = "INFO"
}

[environments.development]
variables = { 
    FLASK_ENV = "development",
    PYTHONPATH = "/app",
    WEB_CONCURRENCY = "1",
    LOG_LEVEL = "DEBUG"
}

# ============================================================================
# CONFIGURACI√ìN DE MONITOREO
# ============================================================================
[monitoring]
enabled = true
healthcheck_grace_period = 60
startup_timeout = 300

# ============================================================================
# CONFIGURACI√ìN DE RED
# ============================================================================
[networking]
port = "$PORT"
